<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä¸­æ–‡å…«å¹´çº§ç”Ÿè¯æ¶ˆæ¶ˆä¹</title>
    <style>
        /* --- åŸºç¡€ä¸å­—ä½“è®¾ç½® --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Nunito:wght@700&display=swap');

        :root {
            --sky-blue-light: #a7e0ff;
            --sky-blue-dark: #69c0ff;
            --bubble-pink: rgba(255, 183, 197, 0.9);
            --bubble-yellow: rgba(255, 246, 183, 0.9);
            --bubble-green: rgba(183, 255, 197, 0.9);
            --bubble-purple: rgba(220, 183, 255, 0.9);
            --highlight-color: #ffdd57;
            --font-family: 'Nunito', 'Noto Sans SC', sans-serif;
            --text-color: #2c3e50;
            --white-color: #ffffff;
            --success-color: #27ae60;
            --start-btn-bg: #ff7675;
            --start-btn-hover: #d63031;
            --selected-color: #48dbfb;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            font-family: var(--font-family);
            overflow: hidden;
            background: linear-gradient(to bottom, var(--sky-blue-light), var(--sky-blue-dark));
            color: var(--text-color);
            user-select: none;
            font-weight: 700;
        }

        /* --- èƒŒæ™¯äº‘æœµåŠ¨ç”» --- */
        .cloud { position: absolute; background: var(--white-color); border-radius: 50%; opacity: 0.8; filter: blur(2px); animation: moveClouds 80s linear infinite; }
        .cloud:before, .cloud:after { content: ''; position: absolute; background: var(--white-color); border-radius: 50%; }
        .cloud1 { width: 200px; height: 60px; top: 10%; left: -250px; }
        .cloud1:before { width: 100px; height: 100px; top: -50px; left: 40px; }
        .cloud1:after { width: 140px; height: 120px; top: -60px; right: 20px; }
        .cloud2 { width: 250px; height: 80px; top: 25%; left: -300px; animation-duration: 60s; animation-delay: -20s; }
        .cloud2:before { width: 120px; height: 120px; top: -60px; left: 50px; }
        .cloud2:after { width: 160px; height: 140px; top: -70px; right: 30px; }
        .cloud3 { width: 180px; height: 50px; top: 60%; left: -200px; animation-duration: 100s; animation-delay: -40s; }
        .cloud3:before { width: 90px; height: 90px; top: -40px; left: 30px; }
        .cloud3:after { width: 120px; height: 100px; top: -50px; right: 20px; }
        @keyframes moveClouds { from { transform: translateX(0); } to { transform: translateX(calc(100vw + 300px)); } }

        /* --- æ•´ä½“å¸ƒå±€ --- */
        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5vh 2vw;
            box-sizing: border-box;
            position: relative;
            z-index: 10;
        }

        /* --- æ§åˆ¶åŒº --- */
        .controls-area {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 1vh 2vw;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            margin-bottom: 1.5vh;
            flex-shrink: 0;
        }
        
        .title {
            text-align: center;
            font-size: clamp(1.8em, 5vmin, 2.5em);
            color: var(--start-btn-hover);
            margin: 0 0 1vh 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        #unit-selection-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1vh;
        }

        #unit-selection-container label {
            display: flex;
            align-items: center;
            background: var(--white-color);
            padding: 0.8vh 1.5vw;
            font-size: clamp(1em, 2.5vmin, 1.2em);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #unit-selection-container input { margin-right: 8px; width: 1.8vmin; height: 1.8vmin; }
        
        #custom-list-container {
            padding: 1vh;
        }
        #custom-list-textarea {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            border: 1px solid #ccc;
            padding: 10px;
            font-size: clamp(0.9em, 2vmin, 1.1em);
            box-sizing: border-box;
        }


        .game-info { 
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 10px;
        }
        .progress-container { justify-self: start; }
        .start-button-wrapper { justify-self: center; }
        .timer-container { justify-self: end; }
        
        .progress-container, .timer-container { font-size: clamp(1em, 2.5vmin, 1.2em); }
        .progress-bar { width: 20vw; max-width: 150px; height: 2.2vmin; min-height: 18px; background: #e0e0e0; border-radius: 10px; overflow: hidden; display: inline-block; margin-left: 10px; vertical-align: middle; }
        .progress-bar-inner { width: 0%; height: 100%; background: var(--success-color); border-radius: 10px; transition: width 0.5s ease; }

        .start-button {
            padding: 1vh 3vw;
            font-size: clamp(1.2em, 3vmin, 1.5em);
            border: none; border-radius: 15px; background: var(--start-btn-bg); color: var(--white-color); cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        .start-button:hover { background: var(--start-btn-hover); transform: translateY(-2px); }
        .start-button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- æ¸¸æˆåŒº --- */
        .game-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 0;
        }

        .bubbles-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1.5vmin;
            padding: 1.5vmin;
            width: 100%;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1) inset;
            flex-grow: 1;
            min-height: 0;
        }

        .bubble {
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(14px, 4vmin, 36px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
            animation: float 6s ease-in-out infinite;
            /* ç¡®ä¿æ–‡å­—ä¸è¶…å‡ºæ³¡æ³¡ */
            padding: 0.5rem;
            text-align: center;
            word-break: keep-all;
            overflow: hidden;
        }

        .bubble:nth-child(4n+1) { background-color: var(--bubble-pink); animation-delay: 0s; }
        .bubble:nth-child(4n+2) { background-color: var(--bubble-yellow); animation-delay: -1.5s; }
        .bubble:nth-child(4n+3) { background-color: var(--bubble-green); animation-delay: -3s; }
        .bubble:nth-child(4n) { background-color: var(--bubble-purple); animation-delay: -4.5s; }
        
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        
        .bubble.selected {
            transform: scale(1.1);
            box-shadow: 0 0 25px var(--selected-color);
            border: 4px solid var(--selected-color);
        }
        
        .bubble.pop {
            animation: pop-out 0.5s forwards;
            pointer-events: none;
        }
        @keyframes pop-out {
            0% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; visibility: hidden; }
        }

        .bubble.wrong { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* --- ç»“æŸå¼¹çª— --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; visibility: hidden; opacity: 0; transition: opacity 0.5s ease, visibility 0.5s ease; }
        .modal-overlay.show { visibility: visible; opacity: 1; }
        .modal-content { background: var(--white-color); padding: 40px; border-radius: 25px; text-align: center; transform: scale(0.7); transition: transform 0.5s ease; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content h2 { font-size: 2.5em; color: var(--success-color); margin-top: 0; margin-bottom: 20px; }
        .modal-content p { font-size: 1.5em; margin-bottom: 30px; }

        /* --- çƒŸèŠ±æ•ˆæœ --- */
        .firework { position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%; opacity: 1; animation: firework-explode 1s forwards; }
        @keyframes firework-explode { to { transform: translate(var(--x), var(--y)) scale(1.5); opacity: 0; } }

        /* --- å“åº”å¼è®¾è®¡ --- */
        @media (orientation: portrait) {
            .bubbles-container {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(6, 1fr);
            }
        }
        
        /* å¤§å±å¹•ä¼˜åŒ– - æ•™å¸ˆæŠ•å±ä½¿ç”¨ */
        @media (min-width: 1200px) {
            .bubbles-container {
                gap: 20px;
                padding: 20px;
            }
            
            .bubble {
                font-size: clamp(18px, 3vmin, 42px);
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯äº‘æœµ -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>

    <div class="game-container">
        <!-- æ§åˆ¶åŒº -->
        <div class="controls-area">
            <h1 class="title">ä¸­æ–‡å…«å¹´çº§ç”Ÿè¯æ¶ˆæ¶ˆä¹ ğŸˆ</h1>
            <div id="unit-selection-container">
                <label><input type="checkbox" name="unit" value="lesson9"> ç¬¬ä¹è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson1"> ç¬¬ä¸€è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson2"> ç¬¬äºŒè¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson3"> ç¬¬ä¸‰è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson4"> ç¬¬å››è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson6"> ç¬¬å…­è¯¾</label>
                <label><input type="checkbox" name="unit" value="custom" id="custom-checkbox"> è‡ªå®šä¹‰</label>
            </div>
            <div id="custom-list-container" style="display: none;">
                <textarea id="custom-list-textarea" placeholder="è¯·è¾“å…¥ç”Ÿå­—å’Œè‹±æ–‡æ„æ€ï¼Œæ¯è¡Œä¸€å¯¹ï¼Œç”¨ç©ºæ ¼éš”å¼€ã€‚ä¾‹å¦‚:&#10;æˆ‘ I&#10;ä½  you"></textarea>
            </div>
            <div class="game-info">
                <div class="progress-container">
                    <span>è¿›åº¦:</span>
                    <div class="progress-bar"><div class="progress-bar-inner"></div></div>
                </div>
                <div class="start-button-wrapper">
                    <button class="start-button" id="startButton" disabled>å¼€å§‹æ¸¸æˆ</button>
                </div>
                <div class="timer-container">
                    <span>æ—¶é—´:</span>
                    <span id="timer">0s</span>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆåŒº -->
        <div class="game-area">
            <div class="bubbles-container" id="bubblesContainer">
                <!-- æ³¡æ³¡ä¼šç”±JSåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div class="modal-overlay" id="winModal">
        <div class="modal-content">
            <h2 id="winMessage">ğŸ‰ æ­å–œä½ ï¼ğŸ‰</h2>
            <p id="winTime"></p>
            <button class="start-button" id="playAgainButton">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <!-- å¼•å…¥Tone.jsç”¨äºéŸ³æ•ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM å…ƒç´ è·å– ---
            const startButton = document.getElementById('startButton');
            const playAgainButton = document.getElementById('playAgainButton');
            const bubblesContainer = document.getElementById('bubblesContainer');
            const timerEl = document.getElementById('timer');
            const progressBarInner = document.querySelector('.progress-bar-inner');
            const winModal = document.getElementById('winModal');
            const unitCheckboxes = document.querySelectorAll('input[name="unit"]');
            const customCheckbox = document.getElementById('custom-checkbox');
            const customListContainer = document.getElementById('custom-list-container');
            const customListTextarea = document.getElementById('custom-list-textarea');

            // --- ç”Ÿå­—æ•°æ® ---
            const wordLists = {
                lesson9: [
                    { char: "å¤©æ°”", meaning: "weather" },
                    { char: "å¤šäº‘", meaning: "cloudy" },
                    { char: "å¤ªé˜³", meaning: "sun" },
                    { char: "é˜´", meaning: "overcast" },
                    { char: "æ™´", meaning: "fine, sunny" },
                    { char: "æœ‰é›¾", meaning: "foggy" },
                    { char: "é£", meaning: "wind" },
                    { char: "åˆ®é£", meaning: "windy" },
                    { char: "ä¸‹é›¨", meaning: "to rain" },
                    { char: "ä¸‹é›ª", meaning: "to snow" },
                    { char: "çƒ­", meaning: "to be hot" },
                    { char: "å†·", meaning: "to be cold" },
                    { char: "å‡‰å¿«", meaning: "to be cool and pleasant" },
                    { char: "å­£èŠ‚", meaning: "season" },
                    { char: "åŒ—äº¬", meaning: "the capital city of China" },
                    { char: "æ˜¥å¤©", meaning: "spring" },
                    { char: "å¤å¤©", meaning: "summer" },
                    { char: "ç§‹å¤©", meaning: "autumn" },
                    { char: "å†¬å¤©", meaning: "winter" },
                    { char: "æ”¾å‡", meaning: "to have a holiday, vacation or break" },
                    { char: "æ˜¥å‡", meaning: "spring break" },
                    { char: "æš‘å‡", meaning: "summer vacation" },
                    { char: "å¯’å‡", meaning: "winter holiday" },
                    { char: "åˆ......åˆ......", meaning: "[indicating more than one condition] and" },
                    { char: "é£æ²™", meaning: "dust storm" },
                    { char: "æ°”æ¸©", meaning: "temperature" },
                    { char: "æœ€é«˜", meaning: "highest" },
                    { char: "æœ€ä½", meaning: "lowest" },
                    { char: "æ‘„æ°", meaning: "Celsius / centigrade" },
                    { char: "åæ°", meaning: "Fahrenheit" },
                    { char: "åº¦", meaning: "degree" },
                    { char: "å¤©æ°”é¢„æŠ¥", meaning: "weather forecast" },
                    { char: "é˜´é›¨", meaning: "overcast and rainy" },
                    { char: "äº‘", meaning: "cloud" },
                    { char: "é›·é˜µé›¨", meaning: "thunder shower" },
                    { char: "è½¬", meaning: "to turn; to shift; to change" },
                    { char: "æ­»", meaning: "deathly; dead; to die" },
                    { char: "é‚£å°±", meaning: "(indicating a consequence) therefore, then" },
                    { char: "å“‡", meaning: "wow [exclamation]" },
                    { char: "ä¼š", meaning: "will; can, to be able to" },
                    { char: "å¸¦", meaning: "to bring, to take" },
                    { char: "é›¨è¡£", meaning: "raincoat" },
                    { char: "é›¨ä¼", meaning: "umbrella" },
                    { char: "æ‹¿", meaning: "to take, to bring (by hand); hold" },
                    { char: "é›¨", meaning: "rain" },
                    { char: "ç¬", meaning: "fire" },
                    { char: "å†«", meaning: "ice" },
                    { char: "æ—¥", meaning: "sun, clear" },
                    { char: "ç¦¾", meaning: "rice crop" },
                    { char: "â»ï¼ˆå·¦ï¼‰", meaning: "mound" },
                    { char: "å¤‚", meaning: "to follow" }
                ],
                lesson1: [
                    { char: "è¯¾ä¸š", meaning: "schoolwork, study, curriculum" },
                    { char: "è¯¾", meaning: "subject; lesson; class" },
                    { char: "ä¸Šè¯¾", meaning: "to attend class, go to class, in class" },
                    { char: "è¯¾ç¨‹è¡¨", meaning: "school timetable" },
                    { char: "æ•°å­¦", meaning: "mathematic / mathematics" },
                    { char: "ç§‘å­¦", meaning: "science" },
                    { char: "ä½“è‚²", meaning: "physical education" },
                    { char: "åœ°ç†", meaning: "geography" },
                    { char: "å†å²", meaning: "history" },
                    { char: "éŸ³ä¹", meaning: "music" },
                    { char: "ç¾æœ¯", meaning: "the fine arts / art" },
                    { char: "çŒœ", meaning: "to guess" },
                    { char: "çŸ¥é“", meaning: "to know" },
                    { char: "ç¬¬", meaning: "a prefix used to form ordinal numbers" },
                    { char: "èŠ‚", meaning: "measure word for lessons, section, period; n.festival" },
                    { char: "ä¸Š", meaning: "adj. previous; upperto v. go to, attend" },
                    { char: "ä¸‹", meaning: "next; under" },
                    { char: "æ€ä¹ˆ", meaning: "how, why" },
                    { char: "å”‰", meaning: "exclaim. (a sigh)" },
                    { char: "è®¨åŒ", meaning: "V. to hate; Adj. annoying" },
                    { char: "ä¸ºä»€ä¹ˆ", meaning: "why" },
                    { char: "ç»†èƒ", meaning: "1. cell; 2. describing someone's talent (arts, music, sports)" },
                    { char: "å°±æ˜¯", meaning: "just, simply (emphasizing a fact)" },
                    { char: "å¤´è„‘", meaning: "1. brain/mind; 2. describing someone's talent (science, math)" },
                    { char: "èªæ˜", meaning: "intelligent / bright/smart" },
                    { char: "è€ƒè¯•", meaning: "V. to give or take an examination; N. exam/test" },
                    { char: "è€ƒ", meaning: "to give or take examination; to test" },
                    { char: "é©¬é©¬è™è™", meaning: "so so" },
                    { char: "è¿˜å¯ä»¥", meaning: "not bad, OK" },
                    { char: "ç³Ÿç³•", meaning: "Terrible" },
                    { char: "å·®", meaning: "not good, not up to standard" },
                    { char: "å¾—", meaning: "de--used after a verb to indicae degree; dÃ©--receive, get; dÄ›i--to have to / must / ought to / to need to" },
                    { char: "åˆ†", meaning: "mark; minute; cent" },
                    { char: "åª", meaning: "only" },
                    { char: "å‡†å¤‡", meaning: "to prepare" },
                    { char: "å¼€å¤œè½¦", meaning: "burn the midnight oil / work late into the night" },
                    { char: "å¥½å¥½å„¿", meaning: "to one's best, in a proper way; to one's heart's content" },
                    { char: "å§“å", meaning: "full name" },
                    { char: "ç­çº§", meaning: "class" }
                ],
                lesson2: [
                    { char: "å­¦ä¹ ", meaning: "to learn; to study" },
                    { char: "æµåˆ©", meaning: "fluent" },
                    { char: "é©¬é©¬è™è™", meaning: "so-so" },
                    { char: "å¾ˆå·®", meaning: "really bad" },
                    { char: "ä¸€èˆ¬èˆ¬", meaning: "so so" },
                    { char: "å°±æ˜¯", meaning: "in the same way as" },
                    { char: "ç³Ÿç³•", meaning: "1. adj. terrible; bad; 2. [exclaim] oh no; how terrible" },
                    { char: "å“ªé‡Œ", meaning: "no (an expression of modest denial)" },
                    { char: "æ„æ€", meaning: "meaning" },
                    { char: "ä»€ä¹ˆæ„æ€", meaning: "what does it mean" },
                    { char: "ä¹…", meaning: "long (of time)" },
                    { char: "å¤š", meaning: "1. how; 2. more than, over" },
                    { char: "ç”Ÿæ´»", meaning: "life" },
                    { char: "æ–°", meaning: "new" },
                    { char: "æ ¡", meaning: "school" },
                    { char: "ç­", meaning: "class" },
                    { char: "ä»¥å‰", meaning: "before / formerly / previous" },
                    { char: "å¥³", meaning: "woman, female" },
                    { char: "å¥³å­ä¸­å­¦", meaning: "girl's middle/high school" },
                    { char: "å“¦", meaning: "exclaim. [indicating understanding or realization]" },
                    { char: "ç”·", meaning: "man, male" },
                    { char: "ç”·å¥³åˆæ ¡", meaning: "co-ed school" },
                    { char: "åƒ", meaning: "thousand" },
                    { char: "ç™¾", meaning: "hundred" },
                    { char: "è¯¾æœ¬", meaning: "textbook" },
                    { char: "å­—å…¸", meaning: "dictionary" },
                    { char: "ä½œä¸š", meaning: "homework" },
                    { char: "ç¬”", meaning: "pen" },
                    { char: "æ‰‹æœº", meaning: "cell phone" },
                    { char: "é’±", meaning: "money" },
                    { char: "å¿˜", meaning: "to forget" },
                    { char: "å‘", meaning: "towards (direction)" },
                    { char: "å€Ÿ", meaning: "borrow, lend" },
                    { char: "è¡Œ", meaning: "all right, O.K." },
                    { char: "æ‹¿å»", meaning: "take (away from the speaker)" },
                    { char: "å˜˜", meaning: "Shh..." },
                    { char: "è¯´è¯", meaning: "to talk" },
                    { char: "æ³¨æ„", meaning: "v. pay attention to; take notice of" },
                    { char: "è¿Ÿåˆ°", meaning: "be late" },
                    { char: "ç¡è¿‡å¤´", meaning: "oversleep" },
                    { char: "ä»¥å", meaning: "later, after" },
                    { char: "å¯ä»¥", meaning: "may, can" },
                    { char: "å˜¿", meaning: "exclaim. hey" },
                    { char: "é—®é¢˜", meaning: "question / problem / issue / topic" },
                    { char: "äº¤", meaning: "hand in" },
                    { char: "ç‹(ğ¤£©)", meaning: "jade" },
                    { char: "æœ¨", meaning: "tree" },
                    { char: "å¥³", meaning: "female" },
                    { char: "ç”°", meaning: "field" },
                    { char: "äº»", meaning: "standing person" },
                    { char: "å¿ƒ", meaning: "heart" },
                    { char: "è¾¶", meaning: "movement, to go & stop" },
                    { char: "åˆ‚", meaning: "knife" },
                    { char: "äº ", meaning: "head" }
                ],
                lesson3: [
                    { char: "æ¯å¤©", meaning: "every day" },
                    { char: "å¤©å¤©", meaning: "every day" },
                    { char: "è·¯", meaning: "road; path" },
                    { char: "èµ°è·¯", meaning: "to walk" },
                    { char: "èµ°", meaning: "to go, to walk (physically)" },
                    { char: "éª‘è‡ªè¡Œè½¦", meaning: "to ride a bicycle" },
                    { char: "å", meaning: "to sit, to board" },
                    { char: "åç«è½¦", meaning: "to take a train" },
                    { char: "å…¬å…±æ±½è½¦", meaning: "bus" },
                    { char: "é£æœº", meaning: "airplane" },
                    { char: "å°è½¿è½¦", meaning: "car" },
                    { char: "åœ°é“", meaning: "subway" },
                    { char: "å‡ºç§Ÿè½¦", meaning: "taxi" },
                    { char: "æ ¡è½¦", meaning: "school bus" },
                    { char: "å¼€", meaning: "to drive, operate" },
                    { char: "åˆ°", meaning: "prep. to; v. arrive, go to" },
                    { char: "é•¿", meaning: "(of space or time) long" },
                    { char: "æ—¶é—´", meaning: "time" },
                    { char: "åªè¦", meaning: "only" },
                    { char: "å¤š", meaning: "is used to mean over or more than" },
                    { char: "å‡ ", meaning: "a few" },
                    { char: "åˆ†é’Ÿ", meaning: "minute" },
                    { char: "ç‚¹é’Ÿ", meaning: "(indicating time of day) o'clock" },
                    { char: "å°æ—¶", meaning: "hour" },
                    { char: "ä½", meaning: "to live, reside" },
                    { char: "ä¸œ", meaning: "east" },
                    { char: "å—", meaning: "south" },
                    { char: "è¥¿", meaning: "west" },
                    { char: "åŒ—", meaning: "north" },
                    { char: "å±±åŒº", meaning: "mountain area" },
                    { char: "åŸå¸‚", meaning: "city" },
                    { char: "è¿‘", meaning: "be near, close" },
                    { char: "è¿œ", meaning: "be far" },
                    { char: "ç¦»", meaning: "be away from (distance)" },
                    { char: "ç¦»......è¿‘/è¿œå—ï¼Ÿ", meaning: "be...close to / far away from...?" },
                    { char: "ç¦»......å¾ˆè¿‘/è¿œ", meaning: "be close to/be far away from" },
                    { char: "ç¦»......æœ‰å¤šè¿œï¼Ÿ", meaning: "how far is the distance from...to...?" },
                    { char: "å…¬é‡Œ", meaning: "kilometer" },
                    { char: "è‹±é‡Œ", meaning: "mile" },
                    { char: "å·®ä¸å¤š", meaning: "1. almost, nearly; 2. about the same" },
                    { char: "é‚®å±€", meaning: "post office" },
                    { char: "ç«™", meaning: "n. station; v. stop" },
                    { char: "ç«è½¦ç«™", meaning: "train station" },
                    { char: "å…¬å…±æ±½è½¦ç«™", meaning: "public bus stop" },
                    { char: "åœ°é“ç«™", meaning: "subway station" },
                    { char: "é£æœºåœº", meaning: "airport" },
                    { char: "å›¾ä¹¦é¦†", meaning: "library" },
                    { char: "å¸‚åœº", meaning: "market" },
                    { char: "ä¹¦åº—", meaning: "bookstore" },
                    { char: "å†°æ·‡æ·‹åº—", meaning: "ice cream store" },
                    { char: "ç™¾è´§å•†åº—", meaning: "department store" },
                    { char: "å® ç‰©åº—", meaning: "pet store" },
                    { char: "ä¸­å›½é¥­é¦†", meaning: "Chinese restaurant" },
                    { char: "é©¬è·¯", meaning: "street / road" },
                    { char: "è·¯å£", meaning: "intersection" },
                    { char: "åå­—è·¯å£", meaning: "crossroads" },
                    { char: "ä¸å­—è·¯å£", meaning: "T-intersection , t-junction" },
                    { char: "çº¢ç»¿ç¯", meaning: "traffic light" },
                    { char: "å¾€", meaning: "towards, to" },
                    { char: "æ‹", meaning: "to turn" },
                    { char: "åŠ³é©¾", meaning: "[polite word used when asking for help] excuse me, may I trouble you" },
                    { char: "è¿‡", meaning: "pass, cross" },
                    { char: "åŠå…¬å®¤", meaning: "office" },
                    { char: "ç¤¼å ‚", meaning: "assembly hall / auditorium" },
                    { char: "å°å–éƒ¨", meaning: "concession stand, snack bar" },
                    { char: "æ•™å®¤", meaning: "classroom" },
                    { char: "æ•™å®¤æ¥¼", meaning: "classroom building" },
                    { char: "æ“åœº", meaning: "playground / sports field" },
                    { char: "ä½“è‚²é¦†", meaning: "gym" },
                    { char: "å•æ‰€", meaning: "restroom" },
                    { char: "å°±åœ¨", meaning: "is right at" },
                    { char: "å¯¹é¢", meaning: "opposite (location)" },
                    { char: "æ—è¾¹", meaning: "next to; the side" },
                    { char: "è¶³", meaning: "foot" },
                    { char: "å½³", meaning: "left step" },
                    { char: "ç«", meaning: "fire" },
                    { char: "æ°µ", meaning: "water" },
                    { char: "äº»", meaning: "standing person" },
                    { char: "äº ", meaning: "lid, head" },
                    { char: "è¾¶", meaning: "to go & stop; movement; walking" },
                    { char: "åˆ‚", meaning: "knife" },
                    { char: "åœŸ", meaning: "earthï¼›soil" }
                ],
                lesson4: [
                    { char: "å‘¨æœ«", meaning: "weekend" },
                    { char: "ä¼‘é—²ç”Ÿæ´»", meaning: "leisure life" },
                    { char: "æ–°é—»", meaning: "news" },
                    { char: "éŸ³ä¹ä¼š", meaning: "concert" },
                    { char: "ç”µè§†å‰§", meaning: "TV Drama/TV series" },
                    { char: "ç”µå½±", meaning: "movie" },
                    { char: "ç§‘å¹»ç”µå½±", meaning: "science fiction movie" },
                    { char: "åŠŸå¤«ç”µå½±", meaning: "kung fu (Chinese martial arts) movie" },
                    { char: "çˆ±æƒ…ç”µå½±", meaning: "love (romantic) movie" },
                    { char: "å¡é€š/åŠ¨ç”»ç‰‡å„¿", meaning: "cartoon" },
                    { char: "åŠ¨ä½œç‰‡/åŠ¨ä½œç‰‡å„¿", meaning: "action movie" },
                    { char: "æ‚²å‰§ç‰‡/æ‚²å‰§ç‰‡å„¿", meaning: "tragedy film" },
                    { char: "å–œå‰§ç‰‡/å–œå‰§ç‰‡å„¿", meaning: "comedy" },
                    { char: "ææ€–ç‰‡/ææ€–ç‰‡å„¿", meaning: "horror movie" },
                    { char: "éƒ¨", meaning: "measure word for films, cars etc." },
                    { char: "èµ›", meaning: "match, contest" },
                    { char: "æ¯”èµ›", meaning: "match, competition" },
                    { char: "çƒèµ›", meaning: "any game that is played with a ball" },
                    { char: "åœº", meaning: "measure word for shows, concerts, competitions etc." },
                    { char: "è¿·", meaning: "enthusiast, fan, ...addict" },
                    { char: "çƒè¿·", meaning: "____ball game fan" },
                    { char: "å¤å…¸éŸ³ä¹", meaning: "classical music" },
                    { char: "æµè¡ŒéŸ³ä¹", meaning: "pop music" },
                    { char: "ä¸€å¤©åˆ°æ™š", meaning: "all day long, from morning until night" },
                    { char: "ç”µè§†èŠ‚ç›®", meaning: "TV program" },
                    { char: "ç”µè§†èŠ‚ç›®æ—¶é—´è¡¨", meaning: "TV program schedule" },
                    { char: "æ— èŠ", meaning: "bored, boring" },
                    { char: "æœ‰æ„æ€/æœ‰è¶£", meaning: "interesting" },
                    { char: "æ²¡æ„æ€", meaning: "not interesting; meaningless; boring." },
                    { char: "ç”µè§†å°", meaning: "(n) television station" },
                    { char: "é¢‘é“", meaning: "(TV or radio) channel" },
                    { char: "æœ‰ä»€ä¹ˆå¥½çš„", meaning: "anything good" },
                    { char: "æ²¡(æœ‰)ä»€ä¹ˆå¥½çš„", meaning: "nothing good" },
                    { char: "è¿‡", meaning: "indicate a past experience" },
                    { char: "æ¬¡", meaning: "measure word [for frequency] time" },
                    { char: "è¿˜æ²¡", meaning: "haven't; not yet." },
                    { char: "æé”™", meaning: "make mistake" },
                    { char: "åˆ«", meaning: "don't" },
                    { char: "æ™šä¼š", meaning: "evening entertainment/party" },
                    { char: "æ˜¥æ™š", meaning: "Spring Festival Gala" },
                    { char: "èšä¼š", meaning: "get-together; party" },
                    { char: "èˆä¼š", meaning: "dance party; ball" },
                    { char: "æ´¾å¯¹", meaning: "party" },
                    { char: "å¼ ", meaning: "a measure word for ticket, paper etc." },
                    { char: "ç¥¨", meaning: "ticket" },
                    { char: "é—¨ç¥¨", meaning: "entrance ticket" },
                    { char: "ä¹å™¨", meaning: "musical instrument" },
                    { char: "è¥¿æ–¹ä¹å™¨", meaning: "western musical instrument" },
                    { char: "ä¸œæ–¹ä¹å™¨", meaning: "eastern musical instrument" },
                    { char: "æ‹‰", meaning: "To play (violin, erhu, etc.); to pull" },
                    { char: "å¼¹", meaning: "play (instrument), pluck e.g. piano, guitar, guzheng etc." },
                    { char: "å¹", meaning: "to blow/to play a wind instrument e.g. flute" },
                    { char: "å°æç´", meaning: "violin" },
                    { char: "é’¢ç´", meaning: "piano" },
                    { char: "å‰ä»–", meaning: "guitar" },
                    { char: "å¤ç­", meaning: "Chinese zither, a 21 or 25 stringed plucked instrument" },
                    { char: "çµç¶", meaning: "Chinese lute, with 4 strings, a large pear-shaped body and a fretted fingerboard" },
                    { char: "äºŒèƒ¡", meaning: "Chinese fiddle, a two-stringed instrument played with a bow" },
                    { char: "ç¬›å­", meaning: "flute" },
                    { char: "å¯¹", meaning: "prep. towards, to (regarding an attitude)" },
                    { char: "å…´è¶£", meaning: "interest in something; hobby" },
                    { char: "å¯¹......æœ‰/æ²¡å…´è¶£", meaning: "be (not) interested in" },
                    { char: "å¯¹......ï¼ˆä¸ï¼‰æ„Ÿå…´è¶£", meaning: "be (not) interested in" },
                    { char: "æœ‰ç©º/æ²¡ç©º", meaning: "to have free time/ don't have free time" },
                    { char: "æœ‰ä»€ä¹ˆäº‹", meaning: "what's the matter? what's up?" },
                    { char: "æ•™", meaning: "teach" },
                    { char: "äº¬å‰§", meaning: "Beijing opera" },
                    { char: "å…è´¹", meaning: "free of charge" },
                    { char: "ç¤»/ç¤º", meaning: "to notify" },
                    { char: "é˜ï¼ˆå³è¾¹ï¼‰", meaning: "city" },
                    { char: "å¿ƒ", meaning: "heart" },
                    { char: "åœŸ", meaning: "earthï¼Œsoil" },
                    { char: "å®€", meaning: "roof with chimney" },
                    { char: "å½¡", meaning: "hairy" },
                    { char: "å¼“", meaning: "bow" },
                    { char: "â»Œ", meaning: "to go and stop" },
                    { char: "åˆ‚", meaning: "knife" },
                    { char: "æœ¨", meaning: "treeï¼Œwood" },
                    { char: "å†‚", meaning: "border" }
                ],
                lesson6: [
                    { char: "å„æœ‰åƒç§‹", meaning: "each has it's merits" },
                    { char: "å¥½ä¹…ä¸è§", meaning: "haven't seen sb. for a very long time" },
                    { char: "é•¿å¾—", meaning: "present state of growth, to look..." },
                    { char: "åƒ", meaning: "alike" },
                    { char: "æ¯”è¾ƒ", meaning: "comparatively / relatively" },
                    { char: "é«˜", meaning: "high / tall" },
                    { char: "çŸ®", meaning: "short (of stature)" },
                    { char: "æŒº", meaning: "prominent (nose)" },
                    { char: "å¡Œ", meaning: "flat (nose)" },
                    { char: "è§‰å¾—", meaning: "to feel; to think" },
                    { char: "ç˜¦", meaning: "thin" },
                    { char: "è‹—æ¡", meaning: "(of a woman) slim" },
                    { char: "èƒ–", meaning: "fat" },
                    { char: "å·", meaning: "curly" },
                    { char: "ç›´", meaning: "straight" },
                    { char: "é•¿", meaning: "long" },
                    { char: "çŸ­", meaning: "short" },
                    { char: "ä¿©", meaning: "two [people]" },
                    { char: "ä»¨", meaning: "three" },
                    { char: "å¥‡æ€ª", meaning: "strange / odd" },
                    { char: "æ¯”", meaning: "than (indicating comparison)" },
                    { char: "è·Ÿ", meaning: "and" },
                    { char: "ä¸€æ ·", meaning: "the same" },
                    { char: "è·Ÿ...ä¸€æ ·", meaning: "the same as ...." },
                    { char: "å‡è‚¥", meaning: "to lose weight" },
                    { char: "å¦‚æœ", meaning: "if, in caseï¼Œ in the event of" },
                    { char: "æ—©é¤", meaning: "breakfast" },
                    { char: "åˆé¤", meaning: "lunch" },
                    { char: "æ™šé¤", meaning: "dinner" },
                    { char: "é¤", meaning: "meal" },
                    { char: "ä¸€æ—¥ä¸‰é¤", meaning: "three meals a day" },
                    { char: "é•¿å¾—ç€æ€¥", meaning: "to describe someone looks older than his/her actual age" },
                    { char: "ç€æ€¥", meaning: "worry / feel anxious" },
                    { char: "ä¸ªå­", meaning: "height / stature / build / size" },
                    { char: "ä¸ªæ€§", meaning: "personality" },
                    { char: "éšå’Œ", meaning: "amiable, easy to get along with" },
                    { char: "å¹½é»˜æ„Ÿ", meaning: "sense of humor" },
                    { char: "åšäº‹", meaning: "to do things" },
                    { char: "å†…å‘", meaning: "introverted" },
                    { char: "é©¬é©¬è™è™", meaning: "1. so-so, not so bad; 2. careless, not be conscientious" },
                    { char: "è®¤çœŸ", meaning: "conscientious; earnest" },
                    { char: "çˆ±", meaning: "to love" },
                    { char: "æŒ‘å‰”", meaning: "v. nitpick; adj. hypercritical" },
                    { char: "ç¬¨å¤´ç¬¨è„‘", meaning: "stupid, have a thick skull" },
                    { char: "å¤–å‘", meaning: "extroverted" },
                    { char: "ç®¡å®¶å©†", meaning: "a nickname for house keeper/bossy person" },
                    { char: "è§", meaning: "to see" },
                    { char: "äº»", meaning: "standing person" },
                    { char: "è½¦", meaning: "vehicle" },
                    { char: "äº ", meaning: "headï¼›lid" },
                    { char: "çŸ¢", meaning: "arrow" },
                    { char: "ç–’", meaning: "sickness" },
                    { char: "æœˆ(è‚‰)", meaning: "meatï¼›flesh" },
                    { char: "å¥³", meaning: "female" },
                    { char: "æœ¨", meaning: "tree; wood" },
                    { char: "è¶³", meaning: "foot" },
                    { char: "å¿„", meaning: "heart" },
                    { char: "å†‚", meaning: "border" }
                ]
            };

            // --- éŸ³æ•ˆåˆæˆå™¨ ---
            let synth;
            const correctSound = () => { if (synth) synth.triggerAttackRelease('C5', '8n', Tone.now()); };
            const wrongSound = () => { if (synth) synth.triggerAttackRelease('G3', '8n', Tone.now()); };
            const popSound = () => { if(Tone && Tone.MembraneSynth){ const popSynth = new Tone.MembraneSynth().toDestination(); popSynth.triggerAttackRelease('C2', '8n', Tone.now()); } };

            // --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
            let gameState = { isGameRunning: false, timerId: null, seconds: 0, firstSelection: null, totalPairs: 0, foundPairs: 0 };

            // --- äº‹ä»¶ç›‘å¬ ---
            startButton.addEventListener('click', startGame);
            playAgainButton.addEventListener('click', startGame);
            bubblesContainer.addEventListener('click', handleBubbleClick);
            unitCheckboxes.forEach(checkbox => checkbox.addEventListener('change', checkStartButtonState));
            customListTextarea.addEventListener('input', checkStartButtonState);


            function checkStartButtonState() {
                const anyUnitChecked = Array.from(unitCheckboxes).some(cb => cb.checked && cb.value !== 'custom');
                const customChecked = customCheckbox.checked;
                customListContainer.style.display = customChecked ? 'block' : 'none';

                if (customChecked) {
                    startButton.disabled = parseCustomList(customListTextarea.value).length === 0;
                } else {
                    startButton.disabled = !anyUnitChecked;
                }
            }


            // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---
            function startGame() {
                // åˆå§‹åŒ–éŸ³æ•ˆ
                if (!synth && typeof Tone !== 'undefined') { 
                    try { 
                        synth = new Tone.PolySynth(Tone.FMSynth).toDestination();
                    } catch (e) { 
                        console.error("Tone.js could not be initialized.", e); 
                    } 
                }

                // é‡ç½®æ¸¸æˆçŠ¶æ€
                if (gameState.timerId) clearInterval(gameState.timerId);
                gameState = { ...gameState, isGameRunning: true, seconds: 0, foundPairs: 0, firstSelection: null };
                bubblesContainer.innerHTML = '';
                winModal.classList.remove('show');
                timerEl.textContent = '0s';

                // è·å–ç”Ÿå­—åˆ—è¡¨
                let wordList = getWordList();
                if (wordList.length < 12) {
                    alert('æ‰€é€‰å•å…ƒçš„ç”Ÿå­—ä¸è¶³12å¯¹ï¼Œè¯·é€‰æ‹©æ›´å¤šå•å…ƒæˆ–åœ¨è‡ªå®šä¹‰ä¸­æ·»åŠ ï¼');
                    return;
                }

                // å‡†å¤‡æ¸¸æˆæ•°æ®
                const gamePairs = shuffleArray(wordList).slice(0, 12);
                gameState.totalPairs = gamePairs.length;
                let allBubblesData = [];
                gamePairs.forEach((pair, index) => {
                    allBubblesData.push({ value: pair.char, type: 'char', pairId: index });
                    allBubblesData.push({ value: pair.meaning, type: 'meaning', pairId: index });
                });
                
                // åˆ›å»ºæ³¡æ³¡å¹¶å¼€å§‹è®¡æ—¶
                shuffleArray(allBubblesData).forEach(data => createBubble(data));
                updateProgress();
                gameState.timerId = setInterval(updateTimer, 1000);
            }
            
            function getWordList() {
                let combinedList = [];
                unitCheckboxes.forEach(checkbox => {
                    if (checkbox.checked && checkbox.value !== 'custom') {
                        combinedList = combinedList.concat(wordLists[checkbox.value]);
                    }
                });

                if (customCheckbox.checked) {
                    combinedList = combinedList.concat(parseCustomList(customListTextarea.value));
                }
                // å»é‡
                return combinedList.filter((item, index, self) => 
                    index === self.findIndex((t) => (
                        t.char === item.char && t.meaning === item.meaning
                    ))
                );
            }

            function parseCustomList(text) {
                return text.split('\n')
                           .map(line => line.trim())
                           .filter(line => line)
                           .map(line => {
                               const parts = line.split(/\s+/);
                               if (parts.length >= 2) {
                                   return { char: parts[0], meaning: parts.slice(1).join(' ') };
                               }
                               return null;
                           })
                           .filter(item => item);
            }


            function handleBubbleClick(e) {
                if (!gameState.isGameRunning) return;
                const clickedBubble = e.target.closest('.bubble');
                if (!clickedBubble || clickedBubble.classList.contains('pop')) return;

                if (gameState.firstSelection === clickedBubble) {
                    clickedBubble.classList.remove('selected');
                    gameState.firstSelection = null;
                    return;
                }

                if (!gameState.firstSelection) {
                    gameState.firstSelection = clickedBubble;
                    clickedBubble.classList.add('selected');
                } else {
                    const first = gameState.firstSelection.dataset;
                    const second = clickedBubble.dataset;

                    if (first.pairId === second.pairId && first.type !== second.type) {
                        correctSound();
                        popSound();
                        gameState.firstSelection.classList.add('pop');
                        clickedBubble.classList.add('pop');
                        gameState.foundPairs++;
                        updateProgress();
                        if (gameState.foundPairs === gameState.totalPairs) {
                            endGame();
                        }
                    } else {
                        wrongSound();
                        gameState.firstSelection.classList.add('wrong');
                        clickedBubble.classList.add('wrong');
                        setTimeout(() => {
                            gameState.firstSelection.classList.remove('wrong');
                            clickedBubble.classList.remove('wrong');
                        }, 400);
                    }
                    gameState.firstSelection.classList.remove('selected');
                    gameState.firstSelection = null;
                }
            }

            function endGame() {
                clearInterval(gameState.timerId);
                gameState.isGameRunning = false;
                document.getElementById('winMessage').textContent = 'ğŸ‰ å¤ªæ£’å•¦ï¼å…¨éƒ¨å®Œæˆï¼ ğŸ‰';
                document.getElementById('winTime').textContent = `ç”¨æ—¶: ${gameState.seconds} ç§’`;
                winModal.classList.add('show');
                for (let i = 0; i < 30; i++) createFirework();
            }

            function createBubble(data) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = data.value;
                bubble.dataset.value = data.value;
                bubble.dataset.type = data.type;
                bubble.dataset.pairId = data.pairId;
                bubblesContainer.appendChild(bubble);
            }

            function updateTimer() {
                gameState.seconds++;
                timerEl.textContent = `${gameState.seconds}s`;
            }
            
            function updateProgress() {
                const percentage = gameState.totalPairs > 0 ? (gameState.foundPairs / gameState.totalPairs) * 100 : 0;
                progressBarInner.style.width = `${percentage}%`;
            }

            function createFirework() {
                const firework = document.createElement('div');
                firework.className = 'firework';
                const modalContent = winModal.querySelector('.modal-content');
                modalContent.appendChild(firework);
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 150 + 50;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                firework.style.setProperty('--x', `${x}px`);
                firework.style.setProperty('--y', `${y}px`);
                firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                const startX = modalContent.offsetWidth / 2;
                const startY = modalContent.offsetHeight / 2;
                firework.style.left = `${startX}px`;
                firework.style.top = `${startY}px`;
                setTimeout(() => firework.remove(), 1000);
            }

            function shuffleArray(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            }
        });
    </script>
</body>
</html>    